{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block body %}

<h1>중고 디테일</h1>
<hr>
<p>{%if trade.Trade_type == 1%} 팝니다 {%else%} 삽니다 {%endif%}</p>
<h3>제목:{{trade.title}}</h3>
<hr>
{{trade.content}}



<a href="{% url 'trade:update' trade.pk  %}">수정</a>
<hr>
<h3>댓글</h3>
<form id="commentForm" data-trade-id="{{trade.pk}}">
    {% csrf_token %}
    {% bootstrap_form comment_from %}
    {% bootstrap_button button_type="submit" content="작성완료" button_class="btn btn-dark mt-4" %}
</form>
<hr>
<div id="comment_box">
    {% for comment in comments %}

    <p>{{comment.content}} <span>|{{comment.user}}</span></p>
    {% endfor %}
</div>



<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const commentFrom = document.querySelector('#commentForm')
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
    commentFrom.addEventListener('submit', function (event) {
        event.preventDefault();
        axios({
            method: 'post',
            url: `${event.target.dataset.tradeId}/comment/`,
            header: { 'X-CSRFtoken': csrftoken },
            data: new FormData(commentFrom)
        })
            .then(response => {
                const comment = document.querySelector('#comment_box')
                const p = document.createElement('p')
                p.innerText = `${response.data.content}|${response.data.username}`
                const hr = document.createElement('hr')
                comment.append(p, hr)
                commentFrom.reset()
            })

    })

</script>
{% endblock body %}